package spring.service.hello;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.Properties;

/*
 * FileName : HelloFactory.java
 * ?…‡ hello.properties file(ë¶?ê°?? •ë³?,Meta-Data) ?˜ ?‚´?š©?„ ?½?–´ Hello instance ë¥? ?ƒ?„± return.
 */
public class HelloFactory {
	///Field
	private Hello hello;
	private Properties properties;
	private static HelloFactory helloFactory;
	
	///Constructor Method
	private HelloFactory(){
	}
	
	///Method
	//==> HelloFactory instance ë¥?  return ?•˜?Š” static method(SingleTon) 
	public synchronized static  HelloFactory getInstance() {
		if( helloFactory == null){
			helloFactory = new HelloFactory();
		}
		return helloFactory;
	}
	
	//==> properties file ?„ ì¶”ìƒ?™”,ìº¡ìŠ?™”?•œ  java.util.Properties instance ?ƒ?„± 
	public void setConfigResource(String configResource) {
		FileInputStream fis = null;
		try {
			fis = new FileInputStream(configResource);
			properties = new Properties();
			properties.load(fis);
		} catch (FileNotFoundException e) {
			e.printStackTrace();
			throw new RuntimeException("1. hello.proerties ?ŒŒ?¼?„ ì°¾ì„?ˆ˜ ?—†?Œ.");
		} catch (IOException e) {
			e.printStackTrace();
			throw new RuntimeException("2. hello.proerties ?ŒŒ?¼ ì´ˆê¸°?™” ?‹œ ?˜¤ë¥? ë°œìƒ.");
		}finally{
			if(fis != null){
				try {
					fis.close();
				} catch (IOException e) {
					e.printStackTrace();	
				}
			}
		}
	}	

  	//==> name ?— ?•´?‹¹?•˜?Š” instance ?ƒ?„±:: default constructor  
	private void newInstanceHello(String name){
		
		String className = properties.getProperty(name).trim();  //==> trim() ?•?’¤ ê³µë°± trim
		System.out.println("!! debug=>hello.properties ?—?„œ ì¶”ì¶œ?•œ className : "+className);

		try {
			Class  cls = Class.forName(className);
			Object obj = cls.newInstance();
			//==> Hello Instance ?™•?¸
			if( obj instanceof Hello){
				this.hello = (Hello)obj;
			}
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
			throw new RuntimeException("1. "+className +"?˜ ?´ë¦„ì„ ê°–ëŠ” classê°? ?—†?Œ.");
		} catch (Exception e) {
			e.printStackTrace();
			throw new RuntimeException("2. "+className +"?˜ instance ?ƒ?„±?‹œ ë¬¸ì œ ë°œìƒ.");
		}
	}
	
  	//==> Hello instance ?ƒ?„±?•˜?Š” newInstanceHello() ?˜¸ì¶? ë°? Hello instance ë¥? return
	public Hello getBean(String name){
		this.newInstanceHello(name);
		return hello;
	}
	
}//end of class